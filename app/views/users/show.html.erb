<p id="notice"><%= notice %></p>

<ul class="tabs" data-tab>
  <li class="tab-title active"><a href="#consultor">Informción General</a></li>
  <li class="tab-title"><a href="#companies">Empresas Asignadas</a></li>
</ul>
<div class="tabs-content">
  <div class="content active" id="consultor">
    <%= link_to 'Atrás', users_path %>
	<h1>Consultor Emprered</h1>
	<br>
	<h2>GENERAL</h2><%= link_to 'Editar', edit_user_path(@user) %>
	<div>
		<h2>Acerca del consultor </h2>
		<p>
		  <strong>Nombre:</strong>
		  <%= @user.name %>
		</p>

		<p>
		  <strong>Email:</strong>
		  <%= @user.email %>
		</p>

		<p>
		  <strong>Lugar:</strong>
		  <%= @user.location %>
		</p>

		<p>
		  <strong>Número máximo de empresas:</strong>
		  <%= @user.num_max_companies %>
		</p>

		<p>
		  <strong>Último inicio de sesión:</strong>
		  <%= @user.last_sign_in_at %>
		</p>

		<h2>Rol</h2>
		<%= link_to 'Editar', edit_role_u_path(@user) %>
		<p>
		  <strong>Rol:</strong>
		  <% if @user.role %>
		  	<%= @user.role.name %>
		  <% end %>
		</p>

		<p>
			<strong>
		    	<% if @user.active %>
		      		<h2>Desactivar</h2>
		      		<p>Esta acción desactivara a este usuario de su cuenta.</p>
		      		<%=link_to "Desactivar", users_deactivate_path(user_id: @user), method: :post, data: { confirm: "¿Estas seguro de desactivar el usuario?" } %>
		    	<% else %>
		      		<h2>Activar</h2>
		      		<p>Esta acción activara a este usuario de su cuenta.</p>
		      		<%=link_to "Activar", users_action_activate_path(user_id: @user), method: :post, data: { confirm: "¿Estas seguro de activar el usuario?" } %>
		    	<% end %>
		  	</strong>
		</p>
	</div>
  </div>
  <div class="content" id="companies">
    	<h2>Empresas asignadas</h2>
		<table>
			<thead>
				<tr>
					<th>Nombre de Empresa</th>
					<th>Estado</th>
					<th>Etapa</th>
					<th>Fecha</th>
					<th>Sector</th>
					<th>Consultor Emprered</th>
					<th>Consultor AE</th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<% Company.where('emprered_id = ? or agent_id = ?',@user.id,@user.id).each do |company| %>
			    	<% if can? :read, company %>
				        <tr>
							<td><%= link_to company.company_name, show_general_path(id:company) %></td>
							<td><%= company.state %></td>
							<td><%= company.stage %></td>
							<td>
							  <%= company.date_start %>
							  <%= company.date_end %>
							</td>
							<td>
							  <% if company.sector %>
								<%= company.sector.name %>
							  <% end %>
							</td>
							<td>
				              <% if company.emprered %>
				                <% if current_user.is? 'admin' %>
				                  <% if company.state == 'Nuevo' %>
				                    <% if company.emprered %>
				                      <%= link_to company.emprered.name, show_user_admin_path(company.emprered) %>
				                      <br> 
				                      <%= link_to 'Cambiar Consultor', edit_asign_emprered_path(company) %>
				                    <% else %>
				                      <%= link_to 'Asignar', edit_asign_emprered_path(company) %>
				                    <% end %>
				                  <% elsif company.state == 'Terminado' %>
				                    <%= link_to company.emprered.name, show_user_admin_path(company.emprered) %> 
				                  <% end %>
				                <% else %>
									<% if company.emprered %>
									  <%= company.emprered.name %>
									<% end %>
				                <% end %>
				              <% end %>
				            </td>
				            <td>
								<% if current_user.is? 'admin' %>
									<% if company.state == 'Nuevo' %>
									  <% if company.agent %>
										<%= link_to company.agent.name, show_user_admin_path(company.agent) %>
									  <% end %>
									  Aún no se llega a etapa de análisis de diagnóstico
									<% elsif company.state == 'Retrasado' %>
									  <% if company.agent %>
										<%= link_to company.agent.name, show_user_admin_path(company.agent) %>
										<%= link_to 'Cambiar Consultor', edit_asign_agent_path(company) %>
									  <% else %>
										Aún no se llega a etapa de análisis de diagnóstico
									  <% end %>
									<% elsif company.state == 'Terminado' %>
									  <%= link_to company.agent.name, show_user_admin_path(company.agent) %>
									<% else %>
									  <% if company.agent %>
										<%= link_to company.agent.name, show_user_admin_path(company.agent) %>
										<%= link_to 'Cambiar Consultor', edit_asign_agent_path(company) %>
									  <% else %>
										<%= link_to 'Asignar', edit_asign_agent_path(company) %> 
									  <% end %>
									<% end %>
								<% else %>
									<% if company.agent %>
									  <%= company.agent.name %>
									<% end %>
								<% end %>
				            </td>
						  </tr>
			      	<% end %>
			    <% end %>
			</tbody>
		</table>
  </div>
</div>
